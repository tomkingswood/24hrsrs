---
import { ChevronDown } from 'lucide-astro';

interface Props {
  question: string;
  answer: string;
  isOpen?: boolean;
}

const { question, answer, isOpen = false } = Astro.props;
const id = `faq-${Math.random().toString(36).substring(2, 9)}`;
---

<div class="border-b border-slate-200 last:border-b-0">
  <button
    type="button"
    class="faq-toggle w-full flex items-center justify-between py-5 text-left group"
    aria-expanded={isOpen ? 'true' : 'false'}
    aria-controls={id}
  >
    <span class="text-lg font-medium text-slate-900 group-hover:text-primary-600 transition-colors pr-4">
      {question}
    </span>
    <ChevronDown class="w-5 h-5 text-slate-400 group-hover:text-primary-600 transition-all faq-icon flex-shrink-0" />
  </button>
  <div
    id={id}
    class="faq-content overflow-hidden transition-all duration-300"
    style={isOpen ? '' : 'max-height: 0;'}
  >
    <div class="pb-5 text-slate-600 leading-relaxed">
      <Fragment set:html={answer} />
    </div>
  </div>
</div>

<script>
  document.querySelectorAll('.faq-toggle').forEach((button) => {
    button.addEventListener('click', () => {
      const content = button.nextElementSibling as HTMLElement;
      const icon = button.querySelector('.faq-icon') as HTMLElement;
      const isExpanded = button.getAttribute('aria-expanded') === 'true';

      button.setAttribute('aria-expanded', isExpanded ? 'false' : 'true');

      if (isExpanded) {
        content.style.maxHeight = '0';
        icon.style.transform = 'rotate(0deg)';
      } else {
        content.style.maxHeight = content.scrollHeight + 'px';
        icon.style.transform = 'rotate(180deg)';
      }
    });
  });

  // Initialize open FAQs
  document.querySelectorAll('.faq-toggle[aria-expanded="true"]').forEach((button) => {
    const content = button.nextElementSibling as HTMLElement;
    const icon = button.querySelector('.faq-icon') as HTMLElement;
    content.style.maxHeight = content.scrollHeight + 'px';
    icon.style.transform = 'rotate(180deg)';
  });
</script>
